<Window x:Class="BackupUtility.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:BackupUtility"
        xmlns:vm="clr-namespace:BackupUtility.ViewModels"
        xmlns:converters="clr-namespace:BackupUtility.Converters"
        mc:Ignorable="d"
        WindowStartupLocation="CenterScreen"
        Title="BackupUtility"
        Icon="/Backup.ico"
        Width="460"
        SizeToContent="Height"
        Background="Transparent"
        WindowStyle="None"
        StateChanged="Window_StateChanged">
    <Window.DataContext>
        <vm:MainWindowViewModel/>
    </Window.DataContext>
    <WindowChrome.WindowChrome>
        <WindowChrome CaptionHeight="32" ResizeBorderThickness="{x:Static SystemParameters.WindowResizeBorderThickness}" />
    </WindowChrome.WindowChrome>
    <Window.Resources>
        <local:NullToBoolConverter x:Key="NullToBoolConverter"/>
        <converters:PathFormatterConverter x:Key="PathFormatter"/>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
    </Window.Resources>
    <Border Background="{DynamicResource Window.Background}" 
            BorderBrush="{DynamicResource Window.Border}" 
            BorderThickness="1"
            CornerRadius="8">
        <Grid x:Name="baseGrid">
            <StackPanel>
                <Grid x:Name="CaptionBar" Margin="4,0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="24"/>
                        <ColumnDefinition/>
                        <ColumnDefinition Width="32"/>
                        <ColumnDefinition Width="32"/>
                        <ColumnDefinition Width="32"/>
                    </Grid.ColumnDefinitions>
                    <Image Grid.Column="0" Width="18" Height="18" Source="/Backup.ico" />
                    <TextBlock Grid.Column="1" Margin="4,0,0,0" VerticalAlignment="Center" FontSize="14"
                                Foreground="{DynamicResource CaptionBar.Foreground}"
                                Text="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=Title}">
                        <TextBlock.Style>
                            <Style TargetType="TextBlock">
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsActive, RelativeSource={RelativeSource AncestorType=Window}}" Value="False">
                                        <Setter Property="Foreground" Value="#818181" />
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </TextBlock.Style>
                    </TextBlock>
                    <Button Grid.Column="2" Click="OnMinimizeButtonClick" Style="{DynamicResource CaptionBar.Button}">
                        <Path Width="12" Height="12" Data="M 2,10 H 10" 
                              Stroke="{Binding Path=Foreground, RelativeSource={RelativeSource AncestorType={x:Type Button}}}"
                              StrokeThickness="1" />
                    </Button>
                    <Button Name="maximizeButton" Grid.Column="3" Click="OnMaximizeRestoreButtonClick" Style="{DynamicResource CaptionBar.Button}">
                        <Path Width="12" Height="12" Data="M 2,2 v8 h8 v-8z"
                              Stroke="{Binding Path=Foreground, RelativeSource={RelativeSource AncestorType={x:Type Button}}}"
                              StrokeThickness="1" />
                    </Button>
                    <Button Name="restoreButton" Grid.Column="4" Click="OnMaximizeRestoreButtonClick" Visibility="Collapsed"
                            Style="{DynamicResource CaptionBar.Button}">
                        <Path Width="12" Height="12"
                              Data="M 2,4 v6 h6 v-6z M 4,2.5 v-1.5 h7 v7 h-1.5"
                              Stroke="{Binding Path=Foreground, RelativeSource={RelativeSource AncestorType={x:Type Button}}}"
                              StrokeThickness="1" />
                    </Button>
                    <Button Grid.Column="5" Click="OnCloseButtonClick" Style="{DynamicResource CaptionBar.CloseButton}">
                        <Path Width="12" Height="12" Data="M 2,2 l8,8 M 10,2 l-8,8"
                              Stroke="{Binding Path=Foreground, RelativeSource={RelativeSource AncestorType={x:Type Button}}}"
                              StrokeThickness="1" />
                    </Button>
                </Grid>
                <Label Content="Backup Device" Foreground="{DynamicResource Window.Foreground}"/>
                <ComboBox x:Name="BackupDriveSelection" IsEditable="False" Margin="8,0" SelectionChanged="BackupDriveSelection_SelectionChanged"/>
                <Label Content="Backup Objects" Foreground="{DynamicResource Window.Foreground}"/>
                <ListView x:Name="BackupObjectsListView"
                          Margin="8,0"
                          ItemsSource="{Binding BackupObjects}"
                          DisplayMemberPath="Source"
                          MouseDoubleClick="BackupObjectsListView_MouseDoubleClick">
                    <ListView.View>
                        <GridView>
                            <GridViewColumn Header="Source" Width="Auto">
                                <GridViewColumn.DisplayMemberBinding>
                                    <Binding Path="Source" Converter="{StaticResource PathFormatter}" />
                                </GridViewColumn.DisplayMemberBinding>
                            </GridViewColumn>
                            <GridViewColumn DisplayMemberBinding="{Binding Path=Destination}" Header="Destination" Width="Auto"/>
                        </GridView>
                    </ListView.View>
                </ListView>
                <Grid x:Name="BackupSourceButtons" Margin="8,0,8,8">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition/>
                        <ColumnDefinition Width="24"/>
                        <ColumnDefinition Width="24"/>
                    </Grid.ColumnDefinitions>
                    <Button x:Name="RemoveFolderButton" Grid.Column="1" 
                            IsEnabled="{Binding ElementName=BackupObjectsListView, Path=SelectedItem, Converter={StaticResource NullToBoolConverter}}" 
                            Command="{Binding RemoveSourceCommand}" 
                            CommandParameter="{Binding ElementName=BackupObjectsListView, Path=SelectedItem}">
                        <Path Stroke="{Binding Foreground, RelativeSource={RelativeSource AncestorType=Button}}" 
                              StrokeThickness="1" Data="M7,11 h8" Width="22" Height="22" Margin="-1"/>
                    </Button>
                    <Button x:Name="AddFolderButton" Grid.Column="2" Command="{Binding AddSourceCommand}">
                        <Path Stroke="{Binding Foreground, RelativeSource={RelativeSource AncestorType=Button}}"
                              StrokeThickness="1" Data="M7,11 h8 M11,7 v8" Width="22" Height="22" Margin="-1"/>
                    </Button>
                </Grid>
                <Grid x:Name="ProcedureControlsBar">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <Button x:Name="CancelBackupButton"
                            Padding="8,0"
                            Height="32" 
                            Margin="8"
                            HorizontalAlignment="Left"
                            Visibility="{Binding IsBackupInProgress, Converter={StaticResource BooleanToVisibilityConverter}}"
                            Command="{Binding CancelBackupCommand}">
                        <TextBlock FontFamily="Segoe Fluent Icons" Text="&#xe711;" FontSize="20" VerticalAlignment="Center"/>
                    </Button>
                    <ProgressBar x:Name="BackupProgessBar"
                                 Grid.Column="1" 
                                 Minimum="0" 
                                 Maximum="100"
                                 Value="{Binding BackupProgress}"
                                 Visibility="{Binding IsBackupInProgress, Converter={StaticResource BooleanToVisibilityConverter}}"
                                 Opacity="0.5"
                                 Height="14"/>
                    <TextBlock Text="{Binding BackupProgress, StringFormat={}{0}%}"
                               Grid.Column="1"
                               Visibility="{Binding IsBackupInProgress, Converter={StaticResource BooleanToVisibilityConverter}}"
                               Foreground="{DynamicResource Window.Foreground}"
                               HorizontalAlignment="Center"
                               VerticalAlignment="Center"/>
                    <Button x:Name="StartBackupButton"
                            Padding="8,0" 
                            Grid.Column="2"
                            Height="32" 
                            Margin="8"
                            HorizontalAlignment="Right"
                            Visibility="{Binding !IsBackupInProgress, Converter={StaticResource BooleanToVisibilityConverter}}"
                            Command="{Binding StartBackupCommand}">
                        <TextBlock FontFamily="Segoe Fluent Icons" Text="&#xE768;" FontSize="20" VerticalAlignment="Center"/>
                    </Button>
                </Grid>
            </StackPanel>
            <Border x:Name="InProgressOverlay"
                    Background="#000000"
                    Opacity="0.8"
                    Margin="0,32,0,46"
                    Visibility="{Binding IsBackupInProgress, Converter={StaticResource BooleanToVisibilityConverter}}"/>
        </Grid>
    </Border>
</Window>
